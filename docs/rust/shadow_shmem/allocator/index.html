<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="In this module is a shared memory allocator that can be used in Shadow to share data between the main simulator process and managed processes. There are three main global functions that are provided:"><title>shadow_shmem::allocator - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-ac92e1bbe349e143.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="shadow_shmem" data-themes="" data-resource-suffix="" data-rustdoc-version="1.76.0 (07dca489a 2024-02-04)" data-channel="1.76.0" data-search-js="search-2b6ce74ff89ae146.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-f2adc0d6ca4d09fb.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-305769736d49e732.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-feafe1bb7466e4bd.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../shadow_shmem/index.html">shadow_shmem</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Module allocator</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate shadow_shmem</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../shadow_shmem/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">shadow_shmem</a>::<wbr><a class="mod" href="#">allocator</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/shadow_shmem/allocator.rs.html#1-540">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>In this module is a shared memory allocator that can be used in Shadow to share data between
the main simulator process and managed processes. There are three main global functions that
are provided:</p>
<p>(1) <code>shmalloc()</code>, which places the input argument into shared memory and returns a <code>Block</code>
smart pointer.
(2) <code>shfree()</code>, which is used to deallocate allocated blocks.
(3) <code>shdeserialize()</code>, which is used to take a serialized block and convert it back into a
<code>Block</code> smart pointer that can be dereferenced.</p>
<p>Blocks can be serialized with the <code>.serialize()</code> member function, which converts the block to a
process-memory-layout agnostic representation of the block. The serialized block can be
one-to-one converted to and from a string for passing in between different processes.</p>
<p>The intended workflow is:</p>
<p>(a) The main Shadow simulator process allocates a shared memory block containing an object.
(b) The block is serialized.
(c) The serialized block is turned into a string.
(d) The string is passed to one of Shadow’s child, managed processes.
(e) The managed process converts the string back to a serialized block.
(f) The serialized block is deserialized into a shared memory block alias.
(g) The alias is dereferenced and the shared object is retrieved.</p>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ShMemBlock.html" title="struct shadow_shmem::allocator::ShMemBlock">ShMemBlock</a></div><div class="desc docblock-short">A smart pointer class that holds a <code>Sync</code> and <code>VirtualAddressSpaceIndependent</code> object. The pointer
is obtained by a call to a shared memory allocator’s <code>alloc()</code> function (or the global
<code>shalloc()</code> function. The memory is freed when the block is dropped.</div></li><li><div class="item-name"><a class="struct" href="struct.ShMemBlockAlias.html" title="struct shadow_shmem::allocator::ShMemBlockAlias">ShMemBlockAlias</a></div><div class="desc docblock-short">This struct is analogous to the <code>ShMemBlock</code> smart pointer, except it does not assume ownership
of the underlying memory and thus does not free the memory when dropped. An alias of a block is
obtained with a call to <code>deserialize()</code> on a <code>SharedMemDeserializer</code> object (or likely by using
the <code>shdeserialize()</code> to make this call on the global shared memory deserializer.</div></li><li><div class="item-name"><a class="struct" href="struct.ShMemBlockSerialized.html" title="struct shadow_shmem::allocator::ShMemBlockSerialized">ShMemBlockSerialized</a></div></li><li><div class="item-name"><a class="struct" href="struct.SharedMemAllocator.html" title="struct shadow_shmem::allocator::SharedMemAllocator">SharedMemAllocator</a></div><div class="desc docblock-short">Safe wrapper around our low-level, unsafe, nostd shared memory allocator. This allocator type
is not meant to be used directly, but can be accessed indirectly via calls made to <code>shmalloc()</code>
and <code>shfree()</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.SharedMemAllocatorDropGuard.html" title="struct shadow_shmem::allocator::SharedMemAllocatorDropGuard">SharedMemAllocatorDropGuard</a></div><div class="desc docblock-short">This struct exists as the intended singleton destructor for the global singleton shared memory
allocator. Because the global allocator has static lifetime, drop() will never be called on it.
Therefore, necessary cleanup routines are not called.</div></li><li><div class="item-name"><a class="struct" href="struct.SharedMemDeserializer.html" title="struct shadow_shmem::allocator::SharedMemDeserializer">SharedMemDeserializer</a></div></li></ul><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.shdeserialize.html" title="fn shadow_shmem::allocator::shdeserialize">shdeserialize</a><sup title="unsafe function">⚠</sup></div><div class="desc docblock-short">This function takes a serialized block and converts it back into a BlockAlias that can be
dereferenced.</div></li><li><div class="item-name"><a class="fn" href="fn.shfree.html" title="fn shadow_shmem::allocator::shfree">shfree</a></div><div class="desc docblock-short">This function frees a previously allocated block.</div></li><li><div class="item-name"><a class="fn" href="fn.shmalloc.html" title="fn shadow_shmem::allocator::shmalloc">shmalloc</a></div><div class="desc docblock-short">This function moves the input parameter into a newly-allocated shared memory block. Analogous to
<code>malloc()</code>.</div></li></ul></section></div></main></body></html>